<?php
declare(strict_types = 1);

header("Content-Security-Policy: default-src 'none'; img-src 'self'; style-src 'unsafe-inline'; base-uri 'none'; form-action 'none'");
include '../config/config.php';

$database = new PDO("mysql:host=$dbHost;dbname=$dbSchema", $dbUsername, $dbPassword);
$statement = $database->prepare('SELECT received, type, report FROM reports ORDER BY received DESC');
$statement->execute();

foreach ($statement as $row) {
	printf('%s <strong>%s</strong><br><pre style="background-color: #EFEFEF; padding: 1em;">%s</pre><hr>',
		htmlspecialchars($row['received']),
		htmlspecialchars($row['type']),
		htmlspecialchars(urldecode(json_encode(json_decode($row['report']), JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES | JSON_UNESCAPED_UNICODE)))
	);
}
