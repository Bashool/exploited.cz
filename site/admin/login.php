<?php
error_reporting(E_ALL & ~E_DEPRECATED);  // ~E_DEPRECATED because mysql extension is deprecated since PHP 5.5
include '../config/config.php';
session_start();
if (isset($_POST['submit'])) {
	if ($pdo) {
		// Use PDO, if you can
		$database = new PDO("mysql:host=$dbHost;dbname=$dbSchema", $dbUsername, $dbPassword);
		$statement = $database->prepare('SELECT password FROM users WHERE username = ?');
		$statement->execute(array($_POST['username']));
		$rows = $statement->fetchAll(PDO::FETCH_ASSOC);
		$row = reset($rows);
	} else {
		// If you're stuck with mysql extension
		mysql_connect($dbHost, $dbUsername, $dbPassword);
		mysql_select_db($dbSchema);
		mysql_set_charset('utf8');
		$username = $_POST['username'];  // WRONG, vulnerable to SQL Injection attack
		// $username = mysql_real_escape_string($_POST['username']);  // CORRECT, for strings only
		$sql = "SELECT password FROM users WHERE username = '$username'";
		$result = mysql_query($sql);
		if (!$result) {
			// Do NOT echo the output of mysql_error()
			echo 'Error';
		}
		$row = mysql_fetch_assoc($result);
	}
	if ($row['password'] == md5($_POST['password'])) {
		$_SESSION['username'] = $username;
		header('Location: http://exploited.cz/admin/admin.php');
	}
}
?>
<html><head><title>Admin</title></head>
<body>
	<form action="" method="post">
		Username: <input type="text" name="username"><br>
		Password: <input type="password" name="password"><br>
		<input type="submit" name="submit"></form></body>
</html>
