<?php
session_start();
$csp = $_GET['csp'] ?? '';
$report = "report-uri /xss/csp-report.php?report";
$headers = [
	'' => false,
	'none' => "Content-Security-Policy: default-src 'none'; {$report}",
	'inline' => "Content-Security-Policy: default-src 'none'; script-src 'unsafe-inline'; {$report}",
	'google' => "Content-Security-Policy: default-src 'none'; script-src 'unsafe-inline' ajax.googleapis.com; {$report}",
	'cloudflare' => "Content-Security-Policy: default-src 'none'; script-src 'unsafe-inline' cdnjs.cloudflare.com; {$report}",
];
if ($headers[$csp]) {
	header($headers[$csp]);
}
?>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.2/knockout-min.js"></script>
<script>alert('jQuery: ' + (typeof $ == 'undefined' ? 'not loaded' : $.fn.jquery));</script>
<script>alert('Knockout: ' + (typeof ko == 'undefined' ? 'not loaded' : ko.version));</script>
<script>alert('Some inline JavaScript');</script>
<h1>Content Security Policy</h1>
<h2>Watch the network tab and console in developer tools</h2>
<p><a href="csp.php">No CSP</a></p>
<p><a href="?csp=none">CSP = none</a><br><code><?php echo htmlspecialchars($headers['none']) ?></code></p>
<p><a href="?csp=inline">CSP = inline</a><br><code><?php echo htmlspecialchars($headers['inline']) ?></code></p>
<p><a href="?csp=google">CSP = google (for jQuery)</a><br><code><?php echo htmlspecialchars($headers['google']) ?></code></p>
<p><a href="?csp=cloudflare">CSP = cloudflare (for Knockout)</a><br><code><?php echo htmlspecialchars($headers['cloudflare']) ?></code></p>
<p>Check also <a href="https://exploited.cz/xss/csp/strict.php">CSP3 <code>'strict-dynamic'</code> demo page</a></p>
<hr>
<p>Source code on <a href="https://github.com/spaze/exploited.cz/blob/master/site/xss/csp.php">GitHub</a></p>
